# Dida Todo Sync v2.0 (OAuth2)

一个强大的 Obsidian 插件，让你可以在 Obsidian 中管理滴答清单（TickTick）的任务。

## ✨ 功能特性

- 🔐 **OAuth2 认证** - 使用官方 OAuth2 协议安全连接滴答清单
- 📋 **任务管理** - 在 Obsidian 中查看、创建、编辑和删除任务
- 🏷️ **多种分组方式** - 支持按时间、项目、状态、优先级分组
- 💾 **记忆功能** - 自动记住你上次选择的分组方式
- 📥 **收集箱支持** - 完整支持滴答清单的收集箱功能
- 🎨 **滴答清单风格界面** - 精美的类滴答清单 UI 设计
- 🔄 **实时同步** - 支持任务的实时创建、更新和删除
- 🎯 **优先级管理** - 支持高、中、低优先级标记
- 📁 **项目管理** - 完整的项目分组显示
- 🏷️ **标签支持** - 支持任务标签管理
- ✅ **子任务** - 支持查看和管理子任务
- 📌 **拖拽排序** - 支持任务和分组的拖拽排序

## 📦 安装说明

### 方法 1: 一键安装（推荐）⭐

1. 下载 [obsidian-dida-sync-v2.0.0.zip](https://github.com/shierbd/obsidian-dida-sync/releases/download/v2.0.0/obsidian-dida-sync-v2.0.0.zip)
2. 解压到你的 Obsidian 库的 `.obsidian/plugins/` 目录
3. 重启 Obsidian
4. 打开 设置 → 第三方插件
5. 找到 "Dida Todo Sync v2.0" 并启用

### 方法 2: 手动安装

1. 下载最新版本的 `main.js`、`manifest.json` 和 `versions.json` 文件
2. 在你的 Obsidian 库中找到 `.obsidian/plugins` 目录
3. 创建一个新文件夹 `obsidian-dida-sync`
4. 将下载的文件放入该文件夹
5. 重启 Obsidian
6. 打开 设置 → 第三方插件
7. 找到 "Dida Todo Sync v2.0" 并启用

你的目录结构应该是这样的：
```
你的笔记库/
└── .obsidian/
    └── plugins/
        └── obsidian-dida-sync/
            ├── main.js
            ├── manifest.json
            └── versions.json
```

### 方法 3: 社区插件（未来支持）

等待插件通过 Obsidian 社区插件审核后，可以直接在 Obsidian 的社区插件市场中搜索并安装。

## ⚙️ 配置指南

### 第一步：创建滴答清单开发者应用

1. 访问 [滴答清单开发者中心](https://developer.dida365.com/manage)
2. 登录你的滴答清单账号
3. 点击"创建应用"
4. 填写应用信息：
   - 应用名称：随意填写（如：Obsidian 同步）
   - 回调地址：**必须填写** `http://localhost:8080/callback`
5. 创建成功后，保存你的 **Client ID** 和 **Client Secret**

### 第二步：在 Obsidian 中配置

1. 打开 Obsidian 设置
2. 找到 "Dida Todo Sync v2.0" 插件设置
3. 填入你刚才获取的 **Client ID** 和 **Client Secret**
4. **回调地址** 保持默认：`http://localhost:8080/callback`

### 第三步：OAuth 授权

1. 在插件设置页面，点击 **"开始授权"** 按钮
2. 浏览器会自动打开滴答清单授权页面
3. 登录并授权应用访问你的任务
4. 授权完成后，浏览器会跳转到：`http://localhost:8080/callback?code=你的授权码`
5. **复制 URL 中 `code=` 后面的授权码**
6. 回到 Obsidian 设置页面，将授权码粘贴到 **"授权码"** 输入框
7. 插件会自动完成令牌交换，显示 ✅ **已认证，令牌有效**

## 📖 使用说明

### 打开任务视图

有三种方式打开任务视图：

1. **命令面板**：按 `Ctrl/Cmd + P`，输入 "打开滴答任务视图"
2. **侧边栏图标**：点击左侧边栏的列表图标 📋
3. **功能区按钮**：点击左下角的滴答同步图标

### 界面说明

#### 顶部工具栏
- 🔍 **搜索按钮** - 展开搜索和筛选选项
- ➕ **添加任务** - 快速添加新任务
- 🔄 **刷新** - 手动刷新任务列表

#### 分组方式
支持四种分组方式，点击下拉菜单切换：
- 📅 **时间分组** - 已逾期、今天、明天、即将到期、无截止日期
- 📁 **项目分组** - 按滴答清单的项目分组
- 📊 **状态分组** - 待办事项、进行中、已完成
- 🔥 **优先级分组** - 高、中、低、无优先级

**提示**：插件会自动记住你上次选择的分组方式！

#### 任务卡片
每个任务卡片显示：
- ☑️ 复选框 - 点击标记完成/未完成
- 📝 任务标题 - 双击可编辑
- 📁 项目名称
- 📅 截止日期（如有）
- 🏷️ 标签（如有）
- ⭐ 优先级图标

#### 任务操作
悬停在任务上会显示操作按钮：
- ⭐ **星标按钮** - 切换优先级（无→低→中→高→无）
- ✏️ **编辑按钮** - 打开详细编辑界面
- 🗑️ **删除按钮** - 删除任务

### 添加新任务

#### 方法 1：快速添加
1. 点击顶部 ➕ 按钮或滚动到底部的输入框
2. 输入任务内容
3. 按 `Enter` 创建任务

**智能解析**：快速添加支持自然语言，例如：
- `明天下午3点开会 #工作 !!` - 自动设置截止日期、标签和高优先级
- `买菜 今晚7点前 [生活]` - 自动识别项目和时间

#### 方法 2：详细编辑
1. 点击任务卡片进入详细编辑界面
2. 可以设置：
   - 任务标题
   - 任务描述
   - 截止日期
   - 优先级
   - 所属项目
   - 标签
   - 状态

### 编辑任务

有两种编辑方式：
1. **快速编辑** - 双击任务标题，直接修改
2. **详细编辑** - 点击任务卡片或编辑按钮，打开完整编辑界面

### 删除任务

1. 悬停在任务上，点击 🗑️ 删除按钮
2. 确认删除操作
3. 任务会从滴答清单中永久删除

### 移动任务

#### 在项目之间移动
1. 拖动任务卡片左侧的 `⋮⋮` 手柄
2. 拖到目标分组区域
3. 松开鼠标完成移动

#### 调整任务顺序
在同一分组内拖动任务可以调整顺序。

### 收集箱（Inbox）

收集箱是滴答清单的系统功能，用于快速收集想法和临时任务。

- 📥 收集箱会自动显示在项目分组的最前面
- 收集箱中的任务可以移动到其他项目
- 其他项目的任务也可以移动到收集箱

## 🎨 界面定制

插件提供了丰富的设置选项：

### 显示选项
- ✅ 显示优先级图标
- ✅ 显示标签
- ✅ 显示子任务
- ✅ 显示附件

### 同步选项
- 🔄 自动同步（开发中）
- ⏱️ 同步间隔

### 高级选项
- 🐛 调试模式
- ⏱️ 网络超时设置
- 🔄 最大重试次数

## ❓ 常见问题

### Q: 我的某个项目没有显示？
A: 请检查：
1. 你的滴答清单中该项目是否存在且未关闭
2. 该项目中是否有任务
3. 尝试点击刷新按钮重新加载
4. 检查是否在搜索/筛选状态下被过滤了

### Q: 收集箱和普通项目有什么区别？
A: 收集箱（Inbox）是滴答清单的系统功能，用于快速收集任务。它始终存在，无法删除或重命名。其他所有项目都是用户自己创建的普通项目。

### Q: 授权失败怎么办？
A: 请检查：
1. Client ID 和 Client Secret 是否正确
2. 回调地址是否设置为 `http://localhost:8080/callback`
3. 授权码是否完整复制（不要包含额外的空格）
4. 授权码是否已过期（建议在获取后立即使用）

### Q: 任务没有同步怎么办？
A: 请尝试：
1. 点击右上角的刷新按钮
2. 检查网络连接
3. 检查 OAuth 令牌是否过期（设置中会显示令牌状态）
4. 重新授权

### Q: 可以离线使用吗？
A: 不可以。插件需要连接滴答清单的 API，必须有网络连接才能使用。

### Q: 支持双向同步吗？
A: 当前版本主要支持从滴答清单同步到 Obsidian 查看和管理。完整的双向同步功能正在开发中。

## 🔒 隐私说明

- 插件使用 OAuth2 协议，不会保存你的滴答清单密码
- 所有数据通过 HTTPS 加密传输
- Access Token 和 Refresh Token 安全保存在 Obsidian 本地
- 插件不会收集或上传任何个人数据
- 你可以随时在设置中清除认证信息

## 📝 更新日志

### v2.0.0 (2025-01-28)

🎉 **重大更新 - OAuth2 版本**

**新功能：**
- ✨ 使用官方 OAuth2 API 替代 Cookie 认证
- 🎨 全新的滴答清单风格界面
- 📋 支持多种分组方式（时间、项目、状态、优先级）
- 💾 自动记住上次选择的分组方式
- 🖱️ 支持任务和分组的拖拽排序
- 📥 完整的收集箱功能支持
- ⚡ 智能任务解析（自然语言输入）
- 🎯 优先级快速切换

**改进：**
- 🚀 更快的加载速度
- 🛡️ 更安全的认证方式
- 💪 更稳定的 API 调用
- 🎨 更美观的界面设计

**修复：**
- ✅ 优化项目显示逻辑
- ✅ 修复任务过滤问题
- ✅ 修复分组记忆功能
- ✅ 修复拖拽移动任务的稳定性

## 🤝 贡献

欢迎提交 Issue 和 Pull Request！

## 📄 许可证

MIT License

## 🔗 相关链接

- [滴答清单官网](https://dida365.com/)
- [滴答清单开发者中心](https://developer.dida365.com/)
- [Obsidian 官网](https://obsidian.md/)

## 💖 支持

如果这个插件对你有帮助，欢迎：
- ⭐ 给项目点个 Star
- 🐛 提交 Bug 报告
- 💡 提出新功能建议
- 📖 完善文档

---

**注意**：本插件为社区开发，不是滴答清单官方产品。
